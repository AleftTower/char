-- Multi-Command Script: G for Char, MouseButton5 for Fly2
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TextChatService = game:GetService("TextChatService")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- وظيفة إرسال الرسالة في الشات
local function sendChatMessage(message)
    -- نظام الشات القديم
    local defaultChatSystem = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
    if defaultChatSystem then
        local sayMessageRequest = defaultChatSystem:FindFirstChild("SayMessageRequest")
        if sayMessageRequest then
            sayMessageRequest:FireServer(message, "All")
            return
        end
    end

    -- نظام الشات الجديد
    if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
        local generalChannel = TextChatService:FindFirstChild("TextChannels") and TextChatService.TextChannels:FindFirstChild("RBXGeneral")
        if generalChannel then
            generalChannel:SendAsync(message)
            return
        end
    end
end

-- وظيفة البحث عن اللاعب تحت الماوس وإرسال الأمر
local function handleInput(cmdType)
    local targetPart = Mouse.Target
    if targetPart then
        local character = targetPart.Parent
        -- التحقق من الملحقات أو الأدوات
        if character and (character:IsA("Accessory") or character:IsA("Tool")) then
            character = character.Parent
        end

        local targetPlayer = Players:GetPlayerFromCharacter(character)
        if targetPlayer and targetPlayer ~= LocalPlayer then
            if cmdType == "char" then
                sendChatMessage("/e /char " .. targetPlayer.Name)
            elseif cmdType == "fly" then
                sendChatMessage("/e /fly2 " .. targetPlayer.Name .. " 100")
            end
        end
    end
end

-- ربط الأزرار (G و MouseButton5)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    -- حرف G للكيبورد
    if input.KeyCode == Enum.KeyCode.G then
        handleInput("char")
    -- الزر الخامس في الماوس
    elseif input.UserInputType == Enum.UserInputType.MouseButton5 then
        handleInput("fly")
    end
end)

-- إشعار للتأكيد
StarterGui:SetCore("SendNotification", {
    Title = "تم التحديث ✅";
    Text = "G: /e /char | Mouse5: /e /fly2";
    Duration = 5;
})

print("Script Updated: MouseButton5 is now Fly2 command")
